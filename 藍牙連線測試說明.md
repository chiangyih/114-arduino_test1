# è—ç‰™é€£ç·šæ¸¬è©¦èªªæ˜

## ğŸ“¡ å•é¡Œèªªæ˜

PC ç«¯é€éè—ç‰™é…å°é€£æ¥ HC-05 å¾Œï¼ŒArduino ç«¯ä»é¡¯ç¤ºã€ŒDisconnectã€ç‹€æ…‹ã€‚

## ğŸ” åŸå› åˆ†æ

HC-05 è—ç‰™æ¨¡çµ„çš„ SPPï¼ˆSerial Port Profileï¼‰é€£ç·šåˆ†ç‚ºå…©å€‹å±¤æ¬¡ï¼š

1. **ç¡¬é«”é…å°å±¤**ï¼šPC èˆ‡ HC-05 å®Œæˆè—ç‰™é…å°ï¼ˆLED é–ƒçˆè®Šæ…¢ï¼‰
2. **æ‡‰ç”¨å±¤é€£ç·š**ï¼šPC ç«¯è»Ÿé«”é–‹å•Ÿ COM Portï¼Œä¸¦é€éåºåˆ—åŸ å‚³é€è³‡æ–™

Arduino åªèƒ½é€éåºåˆ—åŸ æ¥æ”¶è³‡æ–™ä¾†åˆ¤æ–·æ˜¯å¦æœ‰æ‡‰ç”¨å±¤é€£ç·šã€‚

## âœ… è§£æ±ºæ–¹æ¡ˆï¼ˆå·²ä¿®æ­£ï¼‰

### ä¿®æ­£å…§å®¹

å·²åœ¨ `handleBluetoothData()` å‡½å¼ä¸­åŠ å…¥è‡ªå‹•åµæ¸¬æ©Ÿåˆ¶ï¼š

```cpp
// åªè¦æ”¶åˆ°ä»»ä½•è³‡æ–™ï¼Œå°±è¦–ç‚ºè—ç‰™å·²é€£ç·šï¼ˆè‡ªå‹•åµæ¸¬é€£ç·šï¼‰
if (Serial.available() > 0 && !bleConnected) {
  bleConnected = true;
  
  // ç«‹å³æ›´æ–° TFT é¡¯ç¤ºç‚ºã€ŒConnectedã€
  if (currentMenu == MENU_CONNECT_BLE && inSubMenu) {
    tft.fillRect(20, 40, 120, 20, ST77XX_BLACK);
    tft.setTextColor(ST77XX_GREEN);
    tft.setTextSize(2);
    tft.setCursor(20, 40);
    tft.print("Connected");
  }
}
```

### è§¸ç™¼é€£ç·šçš„æ–¹å¼

Arduino æœƒåœ¨ä»¥ä¸‹æƒ…æ³åˆ¤å®šç‚ºå·²é€£ç·šï¼š

1. **æ”¶åˆ°ä»»ä½•åºåˆ—åŸ è³‡æ–™**ï¼ˆè‡ªå‹•åµæ¸¬ï¼‰
2. **æ”¶åˆ° CONNECT å‘½ä»¤**ï¼ˆæ¨™æº–å”å®šï¼‰
3. **æ”¶åˆ° PING å‘½ä»¤**ï¼ˆå¿ƒè·³ç¢ºèªï¼‰
4. **æ”¶åˆ°å…¶ä»–å‘½ä»¤**ï¼ˆWRITE, LOAD ç­‰ï¼‰

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æº–å‚™å·¥ä½œ

1. âœ… HC-05 å·²èˆ‡ PC è—ç‰™é…å°
2. âœ… ç¢ºèª COM Port ç·¨è™Ÿï¼ˆè£ç½®ç®¡ç†å“¡ â†’ é€£æ¥åŸ ï¼‰
3. âœ… Arduino å·²ä¸Šå‚³æœ€æ–°éŸŒé«”
4. âœ… Arduino é¸å–®åˆ‡æ›åˆ°ã€Œ1.Connect to BLEã€

### æ¸¬è©¦æ–¹æ³• 1ï¼šä½¿ç”¨åºåˆ—åŸ ç›£æ§è»Ÿé«”

æ¨è–¦è»Ÿé«”ï¼š
- **Arduino IDE Serial Monitor**
- **PuTTY**
- **Tera Term**
- **RealTerm**

æ­¥é©Ÿï¼š
```
1. é–‹å•Ÿåºåˆ—åŸ è»Ÿé«”
2. é¸æ“‡ HC-05 çš„ COM Portï¼ˆä¾‹å¦‚ COM5ï¼‰
3. è¨­å®šé®‘ç‡ï¼š9600
4. ç™¼é€ä»»ä¸€å‘½ä»¤ï¼š
   - è¼¸å…¥ "CONNECT" ä¸¦æŒ‰ Enter
   - æˆ–è¼¸å…¥ "PING" ä¸¦æŒ‰ Enter
   - æˆ–è¼¸å…¥ä»»æ„å­—å…ƒ
5. è§€å¯Ÿ Arduino TFT è¢å¹•
   âœ… æ‡‰è©²é¡¯ç¤ºã€ŒConnectedã€ï¼ˆç¶ è‰²ï¼‰
6. Arduino æœƒå›å‚³ "ACK"
```

### æ¸¬è©¦æ–¹æ³• 2ï¼šä½¿ç”¨ Python è…³æœ¬

```python
import serial
import time

# ä¿®æ”¹ç‚ºä½ çš„ COM Port
port = 'COM5'  
baud = 9600

try:
    # é–‹å•Ÿåºåˆ—åŸ 
    ser = serial.Serial(port, baud, timeout=1)
    time.sleep(2)  # ç­‰å¾…é€£ç·šç©©å®š
    
    print(f"å·²é€£ç·šåˆ° {port}")
    
    # ç™¼é€ CONNECT å‘½ä»¤
    ser.write(b'CONNECT\n')
    print("å·²ç™¼é€: CONNECT")
    
    # ç­‰å¾…å›æ‡‰
    time.sleep(0.5)
    if ser.in_waiting > 0:
        response = ser.readline().decode().strip()
        print(f"æ”¶åˆ°å›æ‡‰: {response}")
    
    # ä¿æŒé€£ç·š
    while True:
        # æ¯ 2 ç§’ç™¼é€ PING
        time.sleep(2)
        ser.write(b'PING\n')
        print("å·²ç™¼é€: PING")
        
        if ser.in_waiting > 0:
            response = ser.readline().decode().strip()
            print(f"æ”¶åˆ°å›æ‡‰: {response}")

except serial.SerialException as e:
    print(f"éŒ¯èª¤: {e}")
except KeyboardInterrupt:
    print("\nå·²ä¸­æ–·é€£ç·š")
finally:
    if 'ser' in locals() and ser.is_open:
        ser.close()
        print("åºåˆ—åŸ å·²é—œé–‰")
```

### æ¸¬è©¦æ–¹æ³• 3ï¼šä½¿ç”¨ VB.NET ç¨‹å¼

```vb
Imports System.IO.Ports

Public Class Form1
    Dim WithEvents SerialPort1 As New SerialPort()

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' è¨­å®šåºåˆ—åŸ 
        SerialPort1.PortName = "COM5"  ' ä¿®æ”¹ç‚ºå¯¦éš› COM Port
        SerialPort1.BaudRate = 9600
        SerialPort1.DataBits = 8
        SerialPort1.Parity = Parity.None
        SerialPort1.StopBits = StopBits.One
        
        Try
            ' é–‹å•Ÿåºåˆ—åŸ 
            SerialPort1.Open()
            MessageBox.Show("è—ç‰™å·²é€£ç·šï¼")
            
            ' ç™¼é€ CONNECT å‘½ä»¤
            SerialPort1.WriteLine("CONNECT")
            
        Catch ex As Exception
            MessageBox.Show("é€£ç·šå¤±æ•—ï¼š" & ex.Message)
        End Try
    End Sub

    Private Sub SerialPort1_DataReceived(sender As Object, e As SerialDataReceivedEventArgs) Handles SerialPort1.DataReceived
        ' æ¥æ”¶ Arduino å›æ‡‰
        Dim data As String = SerialPort1.ReadLine()
        Debug.WriteLine("æ”¶åˆ°: " & data)
    End Sub

    Private Sub Form1_FormClosing(sender As Object, e As FormClosingEventArgs) Handles Me.FormClosing
        If SerialPort1.IsOpen Then
            SerialPort1.Close()
        End If
    End Sub
End Class
```

## ğŸ¯ é æœŸçµæœ

### Arduino TFT é¡¯ç¤ºè®ŠåŒ–

**é€£ç·šå‰ï¼š**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Connect to BLE    â•‘
â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘                    â•‘
â•‘   Disconnect (ç´…è‰²)â•‘
â•‘                    â•‘
â•‘ PC send command:   â•‘
â•‘ CONNECT or PING    â•‘
â•‘ or any data...     â•‘
â•‘                    â•‘
â•‘ Return:Exit        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**é€£ç·šå¾Œï¼š**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Connect to BLE    â•‘
â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘                    â•‘
â•‘   Connected (ç¶ è‰²) â•‘
â•‘                    â•‘
â•‘ PC send command:   â•‘
â•‘ CONNECT or PING    â•‘
â•‘ or any data...     â•‘
â•‘                    â•‘
â•‘ Return:Exit        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### åºåˆ—åŸ è¨Šæ¯

```
PC â†’ Arduino: CONNECT
Arduino â†’ PC: ACK

PC â†’ Arduino: PING
Arduino â†’ PC: ACK
```

## ğŸ”§ ç–‘é›£æ’è§£

### 1. TFT ä»é¡¯ç¤º Disconnect

**æª¢æŸ¥é …ç›®ï¼š**
- âœ… HC-05 LED æ˜¯å¦æ…¢é–ƒï¼ˆå·²é…å°ï¼‰
- âœ… COM Port æ˜¯å¦æ­£ç¢ºé–‹å•Ÿ
- âœ… é®‘ç‡æ˜¯å¦è¨­å®šç‚º 9600
- âœ… æ˜¯å¦æœ‰ç™¼é€ä»»ä½•è³‡æ–™

**è§£æ±ºæ–¹æ³•ï¼š**
```
1. ç¢ºèª PC ç«¯è»Ÿé«”å·²é–‹å•Ÿ COM Port
2. ç™¼é€æ¸¬è©¦å‘½ä»¤ï¼šPING
3. æª¢æŸ¥ Arduino Serial Monitor æ˜¯å¦æœ‰è¼¸å‡º
4. å˜—è©¦é‡æ–°é…å°è—ç‰™
```

### 2. æ²’æœ‰æ”¶åˆ° ACK å›æ‡‰

**å¯èƒ½åŸå› ï¼š**
- å‘½ä»¤æ ¼å¼éŒ¯èª¤ï¼ˆé ˆåŠ æ›è¡Œç¬¦è™Ÿ \nï¼‰
- TX/RX ç·šæ¥å
- é®‘ç‡ä¸åŒ¹é…

**è§£æ±ºæ–¹æ³•ï¼š**
```
1. ç¢ºèªå‘½ä»¤å¾Œæœ‰æ›è¡Œç¬¦è™Ÿï¼ˆ\n æˆ– \r\nï¼‰
2. æª¢æŸ¥ HC-05 æ¥ç·šï¼š
   - HC-05 TX â†’ Arduino D0 (RX)
   - HC-05 RX â†’ Arduino D1 (TX)
3. ç¢ºèªé›™æ–¹é®‘ç‡éƒ½æ˜¯ 9600
```

### 3. è—ç‰™ç„¡æ³•é…å°

**è§£æ±ºæ–¹æ³•ï¼š**
```
1. HC-05 é è¨­é…å°ç¢¼ï¼š1234 æˆ– 0000
2. ç¢ºèª HC-05 é›»æºç‡ˆæœ‰äº®
3. PC è—ç‰™æœå°‹åˆ° HC-05 æˆ–è‡ªè¨‚åç¨±
4. åˆªé™¤èˆŠçš„é…å°è¨˜éŒ„é‡æ–°é…å°
```

## ğŸ“Š æ”¯æ´çš„å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | æ ¼å¼ | åŠŸèƒ½ | å›æ‡‰ |
|------|------|------|------|
| CONNECT | `CONNECT\n` | å»ºç«‹é€£ç·š | `ACK\n` |
| DISCONNECT | `DISCONNECT\n` | ä¸­æ–·é€£ç·š | `ACK\n` |
| PING | `PING\n` | å¿ƒè·³ç¢ºèª | `ACK\n` |
| WRITE | `WRITE 123\n` | å¯«å…¥ EEPROM | `ACK\n` æˆ– `ERR\n` |
| LOAD | `LOAD 75\n` | CPU Loadingï¼ˆ0-100ï¼‰ | `ACK\n` |

## ğŸ’¡ æç¤º

1. **è‡ªå‹•åµæ¸¬æ©Ÿåˆ¶**ï¼šæ”¶åˆ°ä»»ä½•è³‡æ–™å³è¦–ç‚ºå·²é€£ç·š
2. **å¿ƒè·³ä¿æŒ**ï¼šå»ºè­°æ¯ 2-5 ç§’ç™¼é€ PING ä¿æŒé€£ç·š
3. **æ–·ç·šåµæ¸¬**ï¼šè¶…é 10 ç§’ç„¡è³‡æ–™å¯è¦–ç‚ºæ–·ç·šï¼ˆéœ€é¡å¤–å¯¦ä½œï¼‰
4. **é™¤éŒ¯æ¨¡å¼**ï¼šå¯ä½¿ç”¨ Arduino Serial Monitor ç›£æ§è—ç‰™è³‡æ–™

## ğŸ“ ä¿®æ”¹è¨˜éŒ„

- **2025/11/10**ï¼šæ–°å¢è‡ªå‹•åµæ¸¬é€£ç·šæ©Ÿåˆ¶
- **2025/11/10**ï¼šæ›´æ–° TFT é¡¯ç¤ºèªªæ˜æ–‡å­—
- **2025/11/10**ï¼šå®Œå–„è¨»è§£èˆ‡éŒ¯èª¤è™•ç†

---

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025/11/10  
**å°æ‡‰éŸŒé«”**ï¼šmain.cpp v2.0
