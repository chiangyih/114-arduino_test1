# 韌體測試指南

## 硬體連接檢查表

### 1. MCU 與基本 LED
- [x] Arduino UNO (ATmega328P)
- [x] Red LED 連接至 D13（CPU 運行指示燈）

### 2. WS2812 RGB LED 燈條
- [x] 資料線連接至 **D5**（已更新）
- [x] 電源：5V 和 GND
- [x] 使用 8 顆 WS2812 LED

### 3. ST7735 TFT LCD（軟體 SPI 配置）
按照軟體 SPI 配置接線：
- [x] 腳1: SDA/MOSI → **A4** ✅ 軟體 SPI
- [x] 腳2: SCL/SCK → **A5** ✅ 軟體 SPI
- [x] 腳3: CS (Chip Select) → D10
- [x] 腳4: DC (Data/Command) → D8
- [x] 腳5: RST (Reset) → D9
- [x] 腳6: VCC → 5V
- [x] 腳7: GND → GND
- [x] 腳8: BL (Backlight) → D6

> 📝 **軟體 SPI 配置**：SDA=A4, SCL=A5, CS=D10, DC=D8, RST=D9

### 4. HC-05 藍牙模組
- [x] TX → D0 (RX)
- [x] RX → D1 (TX)
- [x] VCC → 5V
- [x] GND → GND

### 5. 按鍵模組
- [x] KEY_UP → A0（類比輸入腳位）
- [x] KEY_DOWN → A1（類比輸入腳位）
- [x] KEY_ENTER → A2（類比輸入腳位）
- [x] KEY_RETURN → A3（類比輸入腳位）

---

## 功能測試步驟

### F1: CPU 運行指示燈測試
**測試步驟：**
1. 上電後觀察 D13 紅色 LED
2. LED 應以 500ms 間隔閃爍
3. 閃爍應持續且穩定

**預期結果：** ✅ LED 持續閃爍，表示 MCU 正常運行

---

### F2: TFT 顯示初始化測試
**測試步驟：**
1. 上電後觀察 TFT 螢幕
2. 應顯示「TCIVS」（第一行）
3. 應顯示「C201」（第二行）
4. 延遲 2 秒後自動進入主選單

**預期結果：** ✅ 開機畫面正常顯示，2 秒後進入 MENU

---

### F3: RGB Offline 模式測試
**測試步驟：**
1. 在主選單中選擇「RGB Offline」
2. 按 ENTER 進入子選單
3. 使用 UP/DOWN 切換模式：
   - Red：3 顆紅色 LED 閃爍
   - Green：6 顆綠色 LED 閃爍
   - Blue：8 顆藍色 LED 閃爍
   - Gradient：8 顆漸層色 LED 循環變色
4. 按 RETURN 返回主選單

**預期結果：** ✅ WS2812 顯示對應顏色和數量

---

### F4: CountDown 倒數計時測試
**測試步驟：**
1. 在主選單中選擇「CountDown」
2. 按 ENTER 進入，開始從 00:00:10 倒數
3. 觀察 TFT 顯示時間更新
4. 按 ENTER 暫停，再按 ENTER 繼續
5. 等待倒數至 00:00:00

**預期結果：** 
- ✅ 時間每秒正確倒數
- ✅ 到達 00:00:00 時 WS2812 閃爍三次粉紅色
- ✅ 最後持續顯示粉紅色

---

### F5: 藍牙命名測試
**測試步驟：**
1. 使用手機或電腦搜尋藍牙裝置
2. 尋找名稱格式：ODD-01-0001
   - 01：崗位號碼
   - 0001：二進位表示（1 的二進位）

**預期結果：** ✅ 藍牙裝置名稱符合規格

---

### F6-F7: 藍牙通訊測試
**測試步驟：**
1. 在主選單選擇「Connect to BLE」
2. 使用藍牙串口助手連接（波特率 9600）
3. 發送測試命令：
   - `PING` → 應回應 `ACK`
   - `CONNECT` → 應回應 `ACK`，螢幕顯示 Connected
   - `LOAD 30` → WS2812 顯示黃色（25-49%）
   - `LOAD 80` → WS2812 顯示紅色（75-100%）
   - `DISCONNECT` → 應回應 `ACK`，螢幕顯示 Disconnect

**預期結果：** 
- ✅ 命令正確執行
- ✅ 回應 ACK
- ✅ WS2812 顏色對應 CPU Loading 百分比

---

### F8: EEPROM 讀寫測試
**測試步驟：**
1. 透過藍牙發送：`WRITE 123`
2. 應回應 `ACK`
3. 在主選單選擇「EEPROM」
4. 觀察螢幕顯示數值

**預期結果：** 
- ✅ EEPROM 正確儲存數值
- ✅ 螢幕顯示 123（十進位）

---

## 藍牙命令參考

| 命令 | 格式 | 功能 | 回應 |
|------|------|------|------|
| PING | `PING` | 心跳確認 | `ACK` |
| CONNECT | `CONNECT` | 建立連線 | `ACK` |
| DISCONNECT | `DISCONNECT` | 中斷連線 | `ACK` |
| WRITE | `WRITE <DEC>` | 寫入 EEPROM | `ACK`/`ERR` |
| LOAD | `LOAD <VAL>` | 設定 RGB 顏色 | `ACK` |

---

## CPU Loading 顏色對照表

| CPU % | 顏色 | RGB 值 |
|-------|------|--------|
| 0-24% | 綠色 | (0, 255, 0) |
| 25-49% | 黃色 | (255, 255, 0) |
| 50-74% | 橙色 | (255, 128, 0) |
| 75-100% | 紅色 | (255, 0, 0) |

---

## 常見問題排除

### 1. TFT 螢幕無顯示
- 檢查 SPI 接線（CS, DC, RST）
- 確認背光線（BL → D6）已連接
- 檢查電源供應

### 2. WS2812 不亮
- 確認資料線連接至 **D5**（已從 D6 更新）
- 檢查電源（5V、GND）
- 確認程式中 WS2812_PIN 設定為 5

### 3. 藍牙無法連接
- 檢查 HC-05 TX/RX 是否交叉連接
- 確認波特率為 9600
- 檢查藍牙模組電源

### 4. 按鍵無反應
- 檢查按鍵接線（A0-A3，類比腳位可當數位輸入使用）
- 確認上拉電阻或使用 INPUT_PULLUP
- 測試按鍵防彈跳延遲（200ms）
- Arduino UNO 的 A0-A5 可同時作為數位 I/O 使用

### 5. 倒數計時不準確
- 檢查 Timer1 設定
- 確認 timer_ini() 參數正確
- 驗證中斷服務程式是否正常執行

---

## 評分檢查表

| 項目 | 配分 | 測試結果 |
|------|------|----------|
| CPU LED 閃爍 | 10 | [ ] |
| 開機畫面顯示 | 10 | [ ] |
| RGB 顏色控制 | 15 | [ ] |
| 倒數計時功能 | 15 | [ ] |
| 藍牙命名正確 | 10 | [ ] |
| 藍牙通訊正常 | 15 | [ ] |
| CPU Loading 顯示 | 15 | [ ] |
| EEPROM 讀寫 | 10 | [ ] |
| **總分** | **100** | |

---

**測試完成日期：** ___________

**測試人員：** ___________

**備註：**
