# 腳位配置快速參考卡

## 📌 ATmega328P (Arduino UNO) 完整腳位配置

### 數位輸出腳位

| 功能 | 腳位 | 說明 |
|------|------|------|
| **CPU 運行指示燈** | D13 | 紅色 LED，500ms 閃爍 |
| **WS2812 資料線** | D5 | 8 顆 RGB LED 燈條 |
| **TFT 背光** | D6 | ST7735 LCD 背光控制 |

### TFT LCD (ST7735) - 軟體 SPI 介面

**實際硬體配置（軟體 SPI 模式）**

| 順序 | 功能 | Arduino 腳位 | 說明 |
|------|------|--------------|------|
| 1 | **SDA (MOSI)** | **A4** | SPI 資料線（軟體 SPI）✅ |
| 2 | **SCL (SCK)** | **A5** | SPI 時鐘線（軟體 SPI）✅ |
| 3 | **CS (Chip Select)** | D10 | 晶片選擇 |
| 4 | **DC (Data/Command)** | D8 | 資料/命令選擇 |
| 5 | **RST (Reset)** | D9 | 重置 |
| 6 | **VCC** | 5V | 電源（3.3V-5V）|
| 7 | **GND** | GND | 接地 |
| 8 | **BL (Backlight)** | D6 | 背光控制 |

> 📝 **軟體 SPI 配置**：SDA=A4, SCL=A5, CS=D10, DC=D8, RST=D9

### HC-05 藍牙模組 - UART 介面

| 功能 | 腳位 | 說明 |
|------|------|------|
| **TX** | D0 (RX) | 藍牙模組發送 → MCU 接收 |
| **RX** | D1 (TX) | MCU 發送 → 藍牙模組接收 |
| **VCC** | 5V | 電源 |
| **GND** | GND | 接地 |

> ⚠️ **重要**：上傳程式時請先拔除 HC-05 的 TX/RX 連線！

### 按鍵模組 - 類比輸入腳位（作為數位輸入）

| 功能 | 腳位 | 說明 |
|------|------|------|
| **KEY_UP** | A0 | 向上按鍵（選單向上）|
| **KEY_DOWN** | A1 | 向下按鍵（選單向下）|
| **KEY_ENTER** | A2 | 確認按鍵（進入/暫停）|
| **KEY_RETURN** | A3 | 返回按鍵（回上層選單）|

> 💡 **提示**：Arduino UNO 的類比腳位 A0-A5 可同時作為數位輸入使用

---

## 🔌 接線圖（文字版）

```
Arduino UNO (ATmega328P)
========================

數位腳位：
D0  (RX)  ← HC-05 TX
D1  (TX)  → HC-05 RX
D5        → WS2812 Data In
D6        → TFT Backlight
D8        → TFT DC (Data/Command)
D9        → TFT RST (Reset)
D10       → TFT CS (Chip Select)
D13       → RED LED (CPU 運行指示)

類比腳位：
A0        ← KEY_UP (數位輸入)
A1        ← KEY_DOWN (數位輸入)
A2        ← KEY_ENTER (數位輸入)
A3        ← KEY_RETURN (數位輸入)
A4        → TFT SDA/MOSI (軟體 SPI) ✅
A5        → TFT SCL/SCK (軟體 SPI) ✅

電源：
5V  → WS2812 VCC, TFT VCC, HC-05 VCC
GND → 所有模組 GND（共地）
```

---

## 📋 程式碼定義摘要

```cpp
// 數位輸出
#define LED_RED 13        // CPU 運行指示燈
#define WS2812_PIN 5      // WS2812 RGB LED
#define TFT_BL 6          // TFT 背光

// TFT LCD (軟體 SPI) - 實際配置
#define TFT_CS   10       // Chip Select
#define TFT_DC   8        // Data/Command
#define TFT_RST  9        // Reset
#define TFT_MOSI A4       // SDA (MOSI) - 軟體 SPI
#define TFT_SCLK A5       // SCL (SCK) - 軟體 SPI

// 按鍵（類比腳位作為數位輸入）
#define KEY_UP     A0     // 向上
#define KEY_DOWN   A1     // 向下
#define KEY_ENTER  A2     // 確認
#define KEY_RETURN A3     // 返回
```

---

## ⚡ 電源需求

| 模組 | 電壓 | 電流（典型） | 備註 |
|------|------|--------------|------|
| Arduino UNO | 5V | ~50mA | USB 供電或外部 7-12V |
| WS2812 x 8 | 5V | ~480mA | 全亮白色時（60mA/顆）|
| ST7735 TFT | 5V | ~100mA | 含背光 |
| HC-05 | 5V | ~50mA | 待機約 8mA |
| **總計** | **5V** | **~680mA** | 建議使用外部電源供應器 |

> ⚠️ **建議**：使用 5V/1A 以上的外部電源供應器，避免 USB 供電不足

---

## 🎯 功能測試檢查點

### 按鍵功能測試

| 按鍵 | 腳位 | 主選單功能 | 子選單功能 |
|------|------|-----------|-----------|
| UP | A0 | 游標向上移動 | RGB 模式切換（向上）|
| DOWN | A1 | 游標向下移動 | RGB 模式切換（向下）|
| ENTER | A2 | 進入子選單 | 暫停/繼續倒數計時 |
| RETURN | A3 | （無作用）| 返回主選單 |

### 按鍵讀取邏輯

```cpp
// 按下時為 LOW（使用 INPUT_PULLUP）
if (digitalRead(KEY_UP) == LOW) {
    // 按鍵被按下
}
```

---

## 🔍 除錯提示

### 1. 按鍵測試程式

```cpp
void testKeys() {
    Serial.println("=== Key Test ===");
    Serial.print("UP (A0): ");
    Serial.println(digitalRead(KEY_UP) == LOW ? "PRESSED" : "RELEASED");
    
    Serial.print("DOWN (A1): ");
    Serial.println(digitalRead(KEY_DOWN) == LOW ? "PRESSED" : "RELEASED");
    
    Serial.print("ENTER (A2): ");
    Serial.println(digitalRead(KEY_ENTER) == LOW ? "PRESSED" : "RELEASED");
    
    Serial.print("RETURN (A3): ");
    Serial.println(digitalRead(KEY_RETURN) == LOW ? "PRESSED" : "RELEASED");
    
    delay(500);
}
```

### 2. WS2812 測試程式

```cpp
void testWS2812() {
    // 紅色
    for(int i=0; i<8; i++) strip.setPixelColor(i, 255, 0, 0);
    strip.show();
    delay(1000);
    
    // 綠色
    for(int i=0; i<8; i++) strip.setPixelColor(i, 0, 255, 0);
    strip.show();
    delay(1000);
    
    // 藍色
    for(int i=0; i<8; i++) strip.setPixelColor(i, 0, 0, 255);
    strip.show();
    delay(1000);
}
```

### 3. TFT 測試程式

```cpp
void testTFT() {
    tft.fillScreen(ST77XX_RED);
    delay(500);
    tft.fillScreen(ST77XX_GREEN);
    delay(500);
    tft.fillScreen(ST77XX_BLUE);
    delay(500);
    tft.fillScreen(ST77XX_BLACK);
}
```

---

## 📝 修改歷史

| 日期 | 版本 | 修改內容 |
|------|------|----------|
| 2025/11/10 | v1.1 | 更新按鍵腳位為 A0-A3（根據 FirmwareSpec.md）|
| 2025/11/10 | v1.0 | 初始版本，完整實作八大功能 |

---

**列印此卡片，貼在工作區域方便參考！**
